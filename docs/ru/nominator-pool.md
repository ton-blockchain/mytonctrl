# Пул номинаторов

## Запуск валидатора в режиме пула номинаторов

1. Подготовить оборудование для валидатора - 8 vCPUs, 64GB памяти, 1TB SSD, фиксированный IP-адрес, 1Gb/s.

   Для поддержания стабильности сети рекомендуется распределять ноды валидаторов в разных точках мира и не концентрировать их в одном дата-центре.
   Используйте https://status.toncenter.com/, чтобы определить загруженность локации. По карте видно, что высокую загруженность
   имеют дата-центры Европы, а именно в Finland, Germany, Paris. Вследствие чего, крайне не рекомендуем использовать таких провайдеров как Hetzner и OVH.

   > Ваше оборудование должно соответствовать указанной конфигурации или быть выше. Не запускайте валидатор на слабом железе — это негативно влияет на сеть и вас оштрафуют.

   > С мая 2021 года Hetzner запретил майнинг на своих серверах, в данный момент под это правило попадают как PoW, так и PoS алгоритмы. Поднятие обычной ноды уже будет считаться нарушением условий соглашения.

   > **Рекомендуемые провайдеры:** [amazon](https://aws.amazon.com/), [digitalocean](https://www.digitalocean.com/), [linode](https://www.linode.com/), [alibaba cloud](https://alibabacloud.com/), [latitude](https://www.latitude.sh/).

2. Установите и синхронизируйте **mytonctrl**, как описано в https://github.com/ton-blockchain/mytonctrl/blob/master/docs/en/manual-ubuntu.md **только** пункты 1, 2 и 3.

   [Видеоинструкция](https://ton.org/docs/#/nodes/run-node).

3. Отправьте 1 TON на адрес кошелька валидатора, отображаемый в списке `wl`.

4. Введите `aw` чтобы активировать кошелек валидатора.

5. Создайте два пула (для четного и нечетного раунда проверки):
   ```
   new_pool p1 0 1 1000 300000
   new_pool p2 0 1 1001 300000
   ```
   где
    * `p1` — имя пула;
    * `0` % — это доля вознаграждения валидатора (например, используйте 40 для 40%);
    * `1` - максимальное количество номинаторов в пуле (должно быть <= 40);
    * `1000` TON — минимальная ставка валидатора (должна быть >= 1K TON);
    * `300000` TON – минимальная ставка номинатора (должна быть >= 10K TON);

   > (!) Конфигурации пулов не должны быть идентичными, вы можете добавить 1 к минимальной ставке одного пула, чтобы сделать их разными.

   > (!) Используйте https://tonmon.xyz/, чтобы определить текущую минимальную ставку валидатора.

6. Введите `pools_list` чтобы отобразить адреса пулов:

   ```
   pools_list
   Name  Status  Balance  Address
   p1    empty   0        0f98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780qIT
   p2    empty   0        0f9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV5jL
   ```

7. Отправьте по 1 TON в каждый пул и активируйте пулы:
   ```
   mg validator_wallet_001 0f98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780qIT 1
   mg validator_wallet_001 0f9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV5jL 1
   activate_pool p1
   activate_pool p2
   ```

8. Введите `pools_list` чтобы отобразить адреса пулов:
   ```
   pools_list
   Name  Status  Balance      Address
   p1    active  0.731199733  kf98YhXA9wnr0d5XRXT-I2yH54nyQzn0tuAYC4FunT780v_W
   p2    active  0.731199806  kf9qtmnzs2-PumMisKDmv6KNjNfOMDQG70mQdp-BcAhnV8UO
   ```

9. Откройте каждый пул по ссылке "https://tonscan.org/nominator/<address_of_pool>" и проверьте конфигурацию пулов.

10. Внесите депозит валидатора в каждый пул:
    ```
    deposit_to_pool validator_wallet_001 <address_of_pool_1> 1005
    deposit_to_pool validator_wallet_001 <address_of_pool_2> 1005
    ```
    где `1005` TON – сумма депозита. Обратите внимание, что 1 TON будет списана пулом для обработки депозита.


11. Внесите депозит номинатора в каждый пул:

    Перейдите по ссылке пула (**9-ый шаг**) и нажмите **ADD STAKE**.
    Вы также можете внести депозит с помощью **mytonctrl**, для этого используйте команды ниже.

    ```
    mg nominator_wallet_001 <address_of_pool_1> 300001 -C d
    mg nominator_wallet_001 <address_of_pool_2> 300001 -C d
    ```

    > (!) Кошелек номинатора должен быть инициализирован в basechain (workchain 0).

    > (!) Имейте ввиду, что кошелек валидатора и кошелек номинатора необходимо хранить отдельно! Кошелек валидатора храниться на сервере с нодой валидатора, для обеспечения обработки всех системных транзакций. Кошелек номинатора хранится на вашем холодном криптокошельке.

    > Чтобы забрать депозит номинатора, отправьте транзакцию с комментарием `w` на адрес пула (необходимо прикрепить 1 TON для обработки транзакции). Вы также можете сделать это с помощью **mytonctrl**.

12. Активируйте режим пула:
    ```
    set usePool true
    ```

13. Приглашайте номинаторов вносить депозиты в ваши пулы. Участие в валидации начнется автоматически.
    > (!) Вам необходимо иметь не менее 200 TON/месяц на кошельке валидатора для оплаты операций.

## Конфигурация пулов

Если вы хотите одолжить себе, используйте `new_pool p1 0 1 1000 300000` (максимум 1 номинатор, доля валидатора 0%).

Если вы создаете пул для многих номинаторов, используйте что-то вроде этого: `new_pool p1 40 40 10000 10000` (максимум 40 номинаторов, доля валидатора 40%, минимальные доли участников 10 000 ТОН).

## Переключение обычного валидатора в режим пула номинаторов

1. Наберите `set stake 0` чтобы отключить участие в выборах.

2. Подождите, пока обе ваши ставки вернутся от электора.

3. Выполните шаги "Запуск валидатора в режиме пула номинаторов" начиная с **4-го** шага.
